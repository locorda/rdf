name: locorda_rdf
description: Workspace for Locorda RDF libraries.
publish_to: none

environment:
  sdk: ^3.6.0

workspace:
  - packages/locorda_rdf_core
  - packages/locorda_rdf_canonicalization
  - packages/locorda_rdf_mapper
  - packages/locorda_rdf_mapper_annotations
  - packages/locorda_rdf_mapper_generator
  - packages/locorda_rdf_xml
  - packages/locorda_rdf_terms_generator
  - packages/locorda_rdf_terms_core

dev_dependencies:
  melos: ^7.3.0
  lints: ^6.0.0

melos:
  scripts:
    analyze:
      run: dart run melos exec -- dart analyze .
      description: Run `dart analyze` in all packages.

    format:
      run: dart run melos exec -- dart format .
      description: Run `dart format` in all packages.

    format:check:
      run: 'dart format --output=none --set-exit-if-changed packages/ 2>&1 | grep -vE "(Warning: Package resolution error|Failed to resolve package URI)"'
      description: Check if all packages are formatted correctly.

    test:
      run: dart run melos exec --dir-exists=test -- dart test --reporter failures-only 
      description: Run `dart test` in all packages that have a `test` directory (includes all tests).
      # make sure log output is not interleaved
      concurrency: 1

    test:ci:
      run: dart run melos exec --dir-exists=test -- dart test --reporter failures-only --exclude-tags=build-runner
      description: Run `dart test` in all packages that have a `test` directory (excludes slow build-runner tests).
      # make sure log output is not interleaved
      concurrency: 1

    test:build-runner:
      run: dart run melos exec --dir-exists=test -- dart test --reporter failures-only --tags=build-runner
      description: Run build-runner tests that call build_runner (slow, local only).
      concurrency: 1

    upgrade:
      run: dart run melos exec -- dart pub upgrade
      description: Run `dart pub upgrade` in all packages.

    outdated:
      run: dart run melos exec -- dart pub outdated
      description: Check for outdated dependencies in all packages.

  version:
    # Synchronized versioning for all packages in the RDF suite
    updateGitTagRefs: true
    includeCommitId: true
    linkToCommits: true
    # Changelog configuration using conventional commits
    changelog:
      packageFilters:
        - dirExists: 'lib'
      message: |
        ## {version}

        {conventional_commits}
      linkToCommits: true
