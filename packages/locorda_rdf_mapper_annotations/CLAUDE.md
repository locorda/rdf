# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is `locorda_rdf_mapper_annotations`, a Dart package providing annotation system for declarative RDF graph mapping. It's part of the Locorda RDF monorepo workspace and provides compile-time annotations that are processed by `locorda_rdf_mapper_generator` to generate type-safe mapping code between Dart objects and RDF graphs.

**Monorepo Context**: This package is one of 8 packages in the Locorda RDF Suite, managed with Melos. For workspace-wide operations, use `melos` commands from the repository root.

## Development Commands

### Testing
```bash
# Run tests for this package
dart test

# Run tests for all packages (from workspace root)
melos test

# Run specific test
dart test test/path/to/specific_test.dart

# Run tests with coverage
dart test --coverage=coverage
```

### Code Quality
```bash
# Analyze code
dart analyze

# Format code  
dart format .

# Check formatting
dart format --output=none --set-exit-if-changed .
```

### Dart Style Requirements

- Write clean, idiomatic Dart code aligned with package conventions.
- Prefer explicit, concrete types over `dynamic`.
- Use `dynamic` only where absolutely necessary (for example JSON/untyped boundary data) and convert to typed structures as early as possible.
- Avoid leaking `dynamic` into annotation/domain APIs and public models.

### Documentation
```bash
# Generate API documentation
dart doc

# View documentation locally
# Open doc/api/index.html in browser
```

## Code Architecture

### Package Structure
- `/lib/src/base/` - Core annotation interfaces and base mapping classes
- `/lib/src/resource/` - Resource mapping annotations (`@RdfGlobalResource`, `@RdfLocalResource`) 
- `/lib/src/property/` - Property mapping annotations (`@RdfProperty`, `@RdfProvides`)
- `/lib/src/term/` - Term mapping annotations for IRIs, literals, and enums
- `/lib/collection_constants.dart` - Pre-defined collection mapping constants

### Key Components

**Annotation Hierarchy:**
- `RdfAnnotation` - Base interface for all RDF mapping annotations
- `BaseMappingAnnotation<T>` - Base for class-level annotations with mapper references
- `BaseMapping<T>` - Base for property-level mapping configurations

**Core Annotations:**
- **Class-level**: `@RdfGlobalResource`, `@RdfLocalResource`, `@RdfIri`, `@RdfLiteral` 
- **Property-level**: `@RdfProperty`, `@RdfIriPart`, `@RdfValue`, `@RdfMapEntry`
- **Enum**: `@RdfEnumValue` for custom enum serialization values

**Mapping Strategy:**
The annotation system supports multiple mapping approaches:
1. Generated mappers (most common) - annotations processed by `locorda_rdf_mapper_generator`
2. Named mapper injection via `initRdfMapper()` parameters
3. Custom mapper types instantiated at runtime
4. Pre-configured mapper instances

### Important Design Patterns

**IRI Strategy System**: 
- Template-based IRI construction with `{placeholder}` syntax
- Multi-part IRIs from multiple `@RdfIriPart` fields
- Context placeholder resolution with `{+baseUri}` syntax (+ indicates URI expansion)

**Property Mapping Flexibility**:
- Default registry lookup for most mapping properties
- Collections default to `CollectionMapping.auto()` (different from other properties)
- Property-level overrides available for all mapping types

**Lossless RDF Mapping**:
- `@RdfUnmappedTriples` captures unmapped properties
- `RdfGraph` as property type for structured subgraphs
- Document-level preservation with `decodeObjectLossless`/`encodeObjectLossless`

## Development Notes

- This is an annotation-only library - actual mapping logic is in `locorda_rdf_mapper` and generated by `locorda_rdf_mapper_generator`
- All annotations must be compile-time constants due to Dart's annotation requirements
- Generated code assumes this package's types are available at runtime
- Examples in `/example/` directory demonstrate real-world usage patterns
- Comprehensive test coverage maintained with target >90%
- The project uses Dart SDK '^3.6.0' and follows standard Dart package conventions
- CI runs on every push/PR and includes coverage reporting to Codecov